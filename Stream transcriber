{"cells":[{"cell_type":"code","execution_count":1,"metadata":{"id":"Npe9vyYsRkVJ","executionInfo":{"status":"ok","timestamp":1702246955333,"user_tz":300,"elapsed":29290,"user":{"displayName":"Bankerice","userId":"12921911351161322597"}}},"outputs":[],"source":["%%capture\n","!pip3 install whisper_timestamped"]},{"cell_type":"code","execution_count":5,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":13056,"status":"ok","timestamp":1702247051806,"user":{"displayName":"Bankerice","userId":"12921911351161322597"},"user_tz":300},"id":"bas7f6VjUTrT","outputId":"3dae74c2-053a-4f9e-9f4a-9f59a1f0cce8"},"outputs":[{"output_type":"stream","name":"stdout","text":["Importing the dtw module. When using in academic works please cite:\n","  T. Giorgino. Computing and Visualizing Dynamic Time Warping Alignments in R: The dtw Package.\n","  J. Stat. Soft., doi:10.18637/jss.v031.i07.\n","\n","Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(\"/content/drive\", force_remount=True).\n"]}],"source":["from google.colab import drive\n","import json\n","import os\n","import timeit\n","from datetime import timedelta\n","import whisper_timestamped as whisper\n","\n","drive.mount('/content/drive')\n","DATASET_PATH = '/content/drive/MyDrive/CS485/twitch_dataset'"]},{"cell_type":"code","source":["!rm -rf /content/drive/MyDrive/CS485/twitch_dataset/transcripts_copy/"],"metadata":{"id":"K-rLKQ9ud2vy"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["!cp -r /content/drive/MyDrive/CS485/twitch_dataset/transcripts /content/drive/MyDrive/CS485/twitch_dataset/transcripts_copy/"],"metadata":{"id":"Fxyqg3O1be9q"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["!rm -r /content/drive/MyDrive/CS485/twitch_dataset/transcripts_copy/*.txt"],"metadata":{"id":"9TYt3ugvdnCv"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["!ls -r /content/drive/MyDrive/CS485/twitch_dataset/transcripts_copy/"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"dxg9r0t9fhWC","executionInfo":{"status":"ok","timestamp":1701202005584,"user_tz":300,"elapsed":181,"user":{"displayName":"Thomas Ji","userId":"10245120714271122346"}},"outputId":"9f8b4b44-6084-4fb9-8a3c-1b5db41e094b"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["xQc_1975936704_transcript.json\t       Ninja_0_transcript.json\n","xQc_1974910234_transcript.json\t       nickmercs_1949358570_transcript.json\n","xQc_1973815718_transcript.json\t       nickmercs_1948583210_transcript.json\n","xQc_1972151778_transcript.json\t       nickmercs_1947794067_transcript.json\n","xQc_1972093643_transcript.json\t       nickmercs_1944322082_transcript.json\n","xQc_1971096026_transcript.json\t       nickmercs_1943446366_transcript.json\n","xQc_1969795889_transcript.json\t       nickmercs_1941826280_transcript.json\n","Tubbo_1976517592_transcript.json       nickmercs_1938412149_transcript.json\n","Tubbo_1975694145_transcript.json       Mongraal_1974076670_transcript.json\n","Tubbo_1973749075_transcript.json       Mongraal_1972769816_transcript.json\n","Tfue_1806006373_transcript.json        Mongraal_1971203489_transcript.json\n","Tfue_1804912551_transcript.json        Mongraal_1970354097_transcript.json\n","Tfue_1803191503_transcript.json        Mongraal_1969513888_transcript.json\n","Tfue_1802321200_transcript.json        Mongraal_1968633555_transcript.json\n","Tfue_1801485637_transcript.json        Mongraal_1410625983_transcript.json\n","Tfue_1800533802_transcript.json        loltyler1_1973846794_transcript.json\n","Tfue_1799606924_transcript.json        loltyler1_1965973817_transcript.json\n","SypherPK_1976567375_transcript.json    loltyler1_1965243269_transcript.json\n","SypherPK_1975814378_transcript.json    loltyler1_1961908189_transcript.json\n","SypherPK_1972717338_transcript.json    loltyler1_1961025538_transcript.json\n","SypherPK_1972157789_transcript.json    loltyler1_1957733321_transcript.json\n","SypherPK_1971324061_transcript.json    loltyler1_1956999243_transcript.json\n","SypherPK_1971282443_transcript.json    KaiCenat_1964330913_transcript.json\n","SypherPK_1971171019_transcript.json    KaiCenat_1962869726_transcript.json\n","summit1g_1976627350_transcript.json    GeorgeNotFound_1970582584_transcript.json\n","summit1g_1975893853_transcript.json    GeorgeNotFound_1967774197_transcript.json\n","summit1g_1974907334_transcript.json    GeorgeNotFound_1965854100_transcript.json\n","summit1g_1973933981_transcript.json    GeorgeNotFound_1961983711_transcript.json\n","summit1g_1973038002_transcript.json    GeorgeNotFound_1957746039_transcript.json\n","summit1g_1972206646_transcript.json    GeorgeNotFound_1955928853_transcript.json\n","summit1g_1971455119_transcript.json    GeorgeNotFound_1941055110_transcript.json\n","sodapoppin_1975764576_transcript.json  Fortnite_1972828046_transcript.json\n","sodapoppin_1974819902_transcript.json  Fortnite_1960835527_transcript.json\n","sodapoppin_1973041416_transcript.json  Fortnite_1951692000_transcript.json\n","sodapoppin_1972117984_transcript.json  Fortnite_1950794715_transcript.json\n","sodapoppin_1970382888_transcript.json  Fortnite_1949893570_transcript.json\n","sodapoppin_1969648064_transcript.json  Fortnite_1940841274_transcript.json\n","sodapoppin_1968711949_transcript.json  Fortnite_1925295886_transcript.json\n","shroud_1975813047_transcript.json      ESLCS_1975857405_transcript.json\n","shroud_1974826695_transcript.json      ESLCS_1975857404_transcript.json\n","shroud_1973927401_transcript.json      ESLCS_1975853746_transcript.json\n","shroud_1972928552_transcript.json      ESLCS_1975760209_transcript.json\n","shroud_1972065586_transcript.json      ESLCS_1975672983_transcript.json\n","shroud_1970453535_transcript.json      ESLCS_1975196106_transcript.json\n","shroud_1969822315_transcript.json      easportsfc_1938241360_transcript.json\n","pokimane_1976496178_transcript.json    Clix_1976531181_transcript.json\n","pokimane_1975802553_transcript.json    Clix_1975697204_transcript.json\n","pokimane_1975574751_transcript.json    Clix_1974626230_transcript.json\n","pokimane_1973880341_transcript.json    Clix_1973871997_transcript.json\n","pokimane_1969626087_transcript.json    Clix_1972718736_transcript.json\n","pokimane_1967620810_transcript.json    Clix_1972439679_transcript.json\n","pokimane_1965249383_transcript.json    Clix_1972129846_transcript.json\n","Ninja_1974570575_transcript.json       Bugha_1976663819_transcript.json\n","Ninja_1973698488_transcript.json       Bugha_1975935453_transcript.json\n","Ninja_1972716198_transcript.json       Bugha_1968819728_transcript.json\n","Ninja_1972413876_transcript.json       Bugha_1967678469_transcript.json\n","Ninja_1971875648_transcript.json       Bugha_1966839425_transcript.json\n","Ninja_1971287069_transcript.json       Bugha_1964332733_transcript.json\n","Ninja_1970228491_transcript.json       Bugha_1963065100_transcript.json\n"]}]},{"cell_type":"code","source":["%%shell\n","\n","for file in /content/drive/MyDrive/CS485/twitch_dataset/transcripts_copy/*; do\n","    if [[ $file == *_transcript.* ]]; then\n","        new_file=${file%_transcript.*}.json\n","        mv \"$file\" \"$new_file\"\n","    fi\n","done"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"wl9nKwEKc6l0","executionInfo":{"status":"ok","timestamp":1701201859335,"user_tz":300,"elapsed":863,"user":{"displayName":"Thomas Ji","userId":"10245120714271122346"}},"outputId":"7091beee-dd8d-4ced-d490-a2664a009752"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":[]},"metadata":{},"execution_count":37}]},{"cell_type":"code","source":["!for file in /content/drive/MyDrive/CS485/twitch_dataset/transcripts_copy/*.json; do mv \"$file\" \"${file%.json}_transcript.json\"; done"],"metadata":{"id":"UWSIpRS-ib4U"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["streamer = 'Ninja'\n","video = '1966676083'\n","\n","mp3_path = f'{DATASET_PATH}/{streamer}_{video}.mp3'\n","transcription_path = f'{DATASET_PATH}/transcripts/{streamer}_{video}.json'\n","print(f'Processing {streamer} {video}')\n","if not os.path.exists(mp3_path):\n","  print(f'Skipping {mp3_path} as it is not a file')\n","\n","elif os.path.exists(transcription_path):\n","  print('Skipping')\n","else:\n","  try:\n","    audio = whisper.load_audio(mp3_path)\n","    model = whisper.load_model('tiny')\n","    result = whisper.transcribe(model, audio, language = 'en')\n","  except:\n","    print(f'error on {video}')"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"CtKmZkdP0v0Y","outputId":"c61eec15-c348-487f-c182-92da7c4d5131"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Processing Ninja 1966676083\n"]}]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"tdIrjZK1VM51","outputId":"65d17848-b022-48e0-d70b-b7ef883da3a7"},"outputs":[{"output_type":"stream","name":"stdout","text":["Processing GeorgeNotFound 1970582584\n","Skipping\n","Processing GeorgeNotFound 1967774197\n","Skipping\n","Processing GeorgeNotFound 1965854100\n","Skipping\n","Processing GeorgeNotFound 1961983711\n","Skipping\n","Processing GeorgeNotFound 1957746039\n","Skipping\n","Processing GeorgeNotFound 1955928853\n","Skipping\n","Processing GeorgeNotFound 1941055110\n","Skipping\n","tubbo has issues so we skip him\n","tubbo has issues so we skip him\n","tubbo has issues so we skip him\n","tubbo has issues so we skip him\n","tubbo has issues so we skip him\n","tubbo has issues so we skip him\n","tubbo has issues so we skip him\n","Processing loltyler1 1973846794\n","Skipping\n","Processing loltyler1 1965973817\n","Skipping\n","Processing loltyler1 1965243269\n","Skipping\n","Processing loltyler1 1961908189\n","Skipping\n","Processing loltyler1 1961025538\n","Skipping\n","Processing loltyler1 1957733321\n","Skipping\n","Processing loltyler1 1956999243\n","Skipping\n","tubbo has issues so we skip him\n","tubbo has issues so we skip him\n","tubbo has issues so we skip him\n","tubbo has issues so we skip him\n","tubbo has issues so we skip him\n","tubbo has issues so we skip him\n","tubbo has issues so we skip him\n","Processing Mongraal 1974076670\n","Skipping\n","Processing Mongraal 1972769816\n"]},{"output_type":"stream","name":"stderr","text":["100%|█████████████████████████████████████| 72.1M/72.1M [00:01<00:00, 70.0MiB/s]\n"]}],"source":["with open(f'{DATASET_PATH}/streams_light.json', 'r') as streamer_videos_file:\n","  streamer_videos = json.load(streamer_videos_file)\n","\n","for streamer, videos in reversed(streamer_videos.items()):\n","  for idx, video in enumerate(videos):\n","    # if video in ['1974740826', '1973749075']:\n","    #   print(f'error on {video}')\n","    #   continue\n","    if streamer in ['Tubbo', 'Bugha']:\n","      print('tubbo has issues so we skip him')\n","      continue\n","    mp3_path = f'{DATASET_PATH}/{streamer}_{video}.mp3'\n","    transcription_path = f'{DATASET_PATH}/transcripts/{streamer}_{video}.json'\n","    print(f'Processing {streamer} {video}')\n","    if not os.path.exists(mp3_path):\n","      print(f'Skipping {mp3_path} as it is not a file')\n","      continue\n","\n","    if os.path.exists(transcription_path):\n","      print('Skipping')\n","      continue\n","    try:\n","      audio = whisper.load_audio(mp3_path)\n","      model = whisper.load_model('tiny')\n","      result = whisper.transcribe(model, audio, language = 'en')\n","    except:\n","      print(f'error on {video}')\n","      continue\n","\n","    with open(transcription_path, \"w\") as doc:\n","      json.dump(result, doc)\n","\n","# for filename in os.listdir(DATASET_PATH):\n","#   if filename.endswith(\".mp3\") and filename.startswith(streamer):\n","#     filepath = os.path.join(DATASET_PATH, filename)\n","#     print(f\"Started transcribing {filepath}...\")\n","#     start = timeit.default_timer()\n","\n","#     result = model.transcribe(filepath, fp16=False)\n","\n","\n","#     end = timeit.default_timer()\n","#     print(f\"{end - start} seconds elapsed\")\n","#     print(\"--\")\n","\n","# for filename in os.listdir(DATASET_PATH):\n","#   if filename.endswith(\".mp3\") and filename.startswith(streamer):\n","#     filepath = os.path.join(DATASET_PATH, filename)\n","#     print(f\"Started transcribing {filepath}...\")\n","#     start = timeit.default_timer()\n","\n","#     result = model.transcribe(filepath, fp16=False)\n","\n","#     transcript_file_name = DATASET_PATH + \"/transcripts\" + filename.split(\".\")[0] + \"_transcript.txt\"\n","#     json_file_name = DATASET_PATH + \"/transcripts\" + filename.split(\".\")[0] + \"_transcript.json\"\n","#     with open(transcript_file_name, \"w\") as doc:\n","#         for seg in result[\"segments\"]:\n","#             doc.write(\n","#                 f\"[{timedelta(seconds=round(seg['start']))}]-[{timedelta(seconds=round(seg['end']))}]({float(seg['no_speech_prob']):.4f}):{seg['text']}\"\n","#             )\n","#             doc.write(\"\\n\")\n","#     with open(json_file_name, \"w\") as doc:\n","#         doc.write(json.dumps(result, indent=4))\n","\n","#     end = timeit.default_timer()\n","#     print(f\"{end - start} seconds elapsed\")\n","#     print(\"--\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"OAGa7SwGndCW","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1701201272063,"user_tz":300,"elapsed":572,"user":{"displayName":"Thomas Ji","userId":"10245120714271122346"}},"outputId":"66f0ff74-32ba-4d15-86bf-797e2f30542c"},"outputs":[{"output_type":"stream","name":"stdout","text":["Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/Tubbo_1974740826.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/Tubbo_1972873621.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/Tubbo_1972022607.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/Tubbo_1971231113.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/ESLCS_1976102855.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/RiotGames_1975746626.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/RiotGames_1975322068.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/RiotGames_1974793126.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/RiotGames_1974369258.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/RiotGames_1969621699.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/RiotGames_1969203398.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/RiotGames_1968278924.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/tommyinnit_1966747771.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/tommyinnit_1953394460.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/tommyinnit_1930563953.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/tommyinnit_477751494.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/tommyinnit_477751482.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/KaiCenat_1966977019.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/KaiCenat_1966145145.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/KaiCenat_1965301389.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/KaiCenat_1964504720.json\n","Missing: /content/drive/MyDrive/CS485/twitch_dataset/transcripts/KaiCenat_1963738630.json\n","total_streams=138\n","processed_streams=116\n"]}],"source":["with open(f'{DATASET_PATH}/streams_light.json', 'r') as streamer_videos_file:\n","  streamer_videos = json.load(streamer_videos_file)\n","\n","total_streams = sum(len(videos) for videos in streamer_videos.values())\n","processed_streams = 0\n","for streamer, videos in reversed(streamer_videos.items()):\n","  for idx, video in enumerate(videos):\n","    transcription_path = f'{DATASET_PATH}/transcripts/{streamer}_{video}.json'\n","    transcription_path_alt = f'{DATASET_PATH}/transcripts/{streamer}_{video}_transcript.json'\n","    if os.path.exists(transcription_path) or os.path.exists(transcription_path_alt):\n","      processed_streams += 1\n","    else:\n","      print(f\"Missing: {transcription_path}\")\n","\n","print(f\"{total_streams=}\")\n","print(f\"{processed_streams=}\")"]},{"cell_type":"code","source":["remaining_lists = [\n","    \"Tubbo\", \"1974740826.json\",\n","    \"Tubbo\", \"1972873621.json\",\n","    \"Tubbo\", \"1972022607.json\",\n","    \"Tubbo\", \"1971231113.json\",\n","    \"ESLCS\", \"1976102855.json\",\n","    \"RiotGames\", \"1975746626.json\",\n","    \"RiotGames\", \"1975322068.json\",\n","    \"RiotGames\", \"1974793126.json\",\n","    \"RiotGames\", \"1974369258.json\",\n","    \"RiotGames\", \"1969621699.json\",\n","    \"RiotGames\", \"1969203398.json\",\n","    \"RiotGames\", \"1968278924.json\",\n","    \"tommyinnit\", \"1966747771.json\",\n","    \"tommyinnit\", \"1953394460.json\",\n","    \"tommyinnit\", \"1930563953.json\",\n","    \"tommyinnit\", \"477751494.json\",\n","    \"tommyinnit\", \"477751482.json\",\n","    \"KaiCenat\", \"1966977019.json\",\n","    \"KaiCenat\", \"1966145145.json\",\n","    \"KaiCenat\", \"1965301389.json\",\n","    \"KaiCenat\", \"1964504720.json\",\n","    \"KaiCenat\", \"1964330913.json\",\n","    \"KaiCenat\", \"1963738630.json\",\n","]"],"metadata":{"id":"dboRJEhxfZce"},"execution_count":null,"outputs":[]}],"metadata":{"colab":{"provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}